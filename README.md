# 국내 주식 차트 분석 및 AI 분석 프로그램

국내 주식의 일봉/주봉/월봉 데이터를 조회하고 기술적 분석을 제공하며, AI 제미나이를 활용한 차트 분석까지 수행하는 Python 프로그램입니다.

## 🚀 주요 기능

### 📊 차트 데이터 조회 (일봉/주봉/월봉 지원)
- **1년간 일봉 데이터** 자동 조회
- **주봉/월봉 데이터** 지원
- **Yahoo Finance API** 활용
- **국내 주식 종목코드** 지원 (6자리 숫자)

### 📈 기술적 지표 분석
- **이동평균선**: 5일, 20일, 60일, 120일
- **MACD**: 12일/26일 EMA, 9일 Signal, Histogram
- **RSI**: 14일 기준 과매수/과매도 구간 분석

### 📊 차트 시각화
- **일봉/주봉/월봉 캔들차트** + 이동평균선
- **거래량 차트**
- **MACD 차트** (MACD, Signal, Histogram)
- **RSI 차트** (과매수/과매도 구간 표시)

### 🤖 AI 차트 분석 (NEW!)
- **Google Gemini AI** 활용한 차트 이미지 분석
- **일봉/주봉/월봉별 특화 프롬프트** 지원
- **자동 기술적 지표 해석**
- **투자 아이디어 및 매매 시점 제안**
- **JSON 형태의 구조화된 분석 결과**

### 🔍 분석 리포트
- **가격 정보**: 시작가, 종가, 최고가, 최저가
- **변동 정보**: 가격 변동, 변동률
- **거래량 정보**: 평균/최대/최소 거래량
- **기술적 지표**: 최신값 및 신호 분석
- **이동평균 신호**: 추세 분석
- **캔들 패턴**: 최근 패턴 분석

## 📋 설치 요구사항

### Python 버전
- Python 3.7 이상

### 필수 라이브러리
```
yfinance>=0.2.0
pandas>=1.3.0
numpy>=1.21.0
matplotlib>=3.5.0
mplfinance>=0.12.0
google-generativeai>=0.3.0
requests>=2.28.0
Pillow>=9.0.0
json5>=0.9.0
python-docx>=0.8.11
```

### AI API 요구사항
- **Google AI API 키** (Gemini)
- https://makersuite.google.com/app/apikey 에서 발급 가능

## 🛠️ 설치 방법

### 1. 라이브러리 설치

**Windows:**
```bash
pip install -r requirements.txt
```

**Linux/macOS:**
```bash
pip3 install -r requirements.txt
```

### 2. 자동 설치 스크립트 사용

**Windows:**
```bash
install.bat
```

**Linux/macOS:**
```bash
chmod +x install.sh
./install.sh
```

### 3. AI API 키 설정

```bash
python setup_api_key.py
```

## 🎯 사용 방법

### 1. 통합 실행 (권장)
```bash
python integrated_stock_analysis.py
```
**새로운 플로우:**
1. 종목명 입력 (예: 삼성전자, SK하이닉스)
2. 차트 유형 선택 (일봉/주봉/월봉)
3. 차트 생성
4. AI 분석
5. 결과 저장 (JSON + Word 문서)

### 2. 배치 분석 (NEW!)
```bash
python batch_stock_analyzer.py
```
**배치 처리 플로우:**
1. 종목 목록 입력 (직접 입력 또는 파일에서 읽기)
2. 차트 유형 선택 (일봉/주봉/월봉)
3. 병렬 처리 설정 (동시 처리할 종목 수)
4. 자동 배치 분석 실행
5. 결과 요약 및 개별 파일 저장

**특징:**
- **병렬 처리**: 여러 종목을 동시에 분석하여 시간 단축
- **진행률 표시**: 실시간 진행률 및 예상 완료 시간 표시
- **유연한 입력**: 종목코드, 종목명 혼합 입력 지원
- **파일 기반 입력**: `stock_list.txt` 파일에서 종목 목록 읽기
- **결과 요약**: 전체 분석 결과 통계 및 개별 파일 저장

### 3. 개별 차트 생성
```bash
# 일봉 차트
python day_stock_analysis.py

# 주봉 차트  
python week_stock_analysis.py

# 월봉 차트
python month_stock_analysis.py
```

### 4. AI 차트 분석 (차트 이미지 필요)
```bash
python ai_chart_analysis.py
```

### 5. API 키 설정
```bash
python setup_api_key.py
```

## 📁 파일 구조

```
stock_analysis/
├── day_stock_analysis.py          # 일봉 차트 생성 스크립트
├── week_stock_analysis.py         # 주봉 차트 생성 스크립트
├── month_stock_analysis.py        # 월봉 차트 생성 스크립트
├── ai_chart_analysis.py           # AI 차트 분석 스크립트 (일봉/주봉/월봉 지원)
├── integrated_stock_analysis.py   # 통합 실행 스크립트 (새로운 플로우)
├── batch_stock_analyzer_optimized.py  # 배치 분석 스크립트 (최적화)
├── setup_api_key.py              # API 키 설정 스크립트
├── config.py                     # 설정 관리 모듈
├── requirements.txt              # 필수 라이브러리 목록
├── stock_list.txt                # 배치 분석용 종목 목록 파일
├── daily_charts/                 # 일봉 차트 이미지 저장 폴더
├── weekly_charts/                # 주봉 차트 이미지 저장 폴더
├── monthly_charts/               # 월봉 차트 이미지 저장 폴더
├── ai_analysis_results/          # AI 분석 결과 저장 폴더
├── api/                          # 웹 API 모듈
├── templates/                    # 웹 템플릿
├── static/                       # 웹 정적 파일
├── uploads/                      # 파일 업로드 폴더
└── results/                      # 분석 결과 폴더
```

## 🤖 AI 분석 기능

### 차트 유형별 특화 분석

#### 📊 일봉 차트 분석
- **단기 모멘텀** 분석
- **최근 5일간** 가격 움직임
- **단기 투자 아이디어** 제공

#### 📈 주봉 차트 분석  
- **중기 추세** 분석
- **최근 8주간** 가격 움직임
- **중기 투자 전략** 제공

#### 📊 월봉 차트 분석
- **장기 추세** 분석
- **최근 12개월간** 가격 움직임
- **장기 투자 전략** 제공

### 분석 항목
1. **가격 및 거래량 분석**
   - 차트 유형별 기간 가격 움직임
   - 거래량 변화 및 특이점
   - 주요 가격대 돌파/이탈 여부

2. **이동평균선 분석**
   - 정배열/역배열 여부
   - 골든 크로스/데드 크로스 발생 여부
   - 이동평균선 밀집도 분석

3. **MACD 분석**
   - MACD/시그널 선 위치 관계
   - 히스토그램 변화 분석
   - 가격과 MACD 다이버전스 확인

4. **RSI 분석**
   - 과매수/과매도 구간 판단
   - 가격과 RSI 다이버전스 확인

5. **투자 아이디어**
   - 차트 유형별 추세 및 모멘텀 종합 판단
   - 매수/매도 시점 제안

### 분석 결과 예시
```json
{
  "종목정보": {
    "종목명": "삼성전자",
    "종목번호": "005930",
    "분석일시": "2025-01-15 14:30:25",
    "차트유형": "일봉"
  },
  "가격및거래량": {
    "최근5일가격동향": "상승",
    "거래량특징": "거래량 증가 추세",
    "주요가격대": "저항선 돌파 시도"
  },
  "이동평균선": {
    "정배열여부": true,
    "현재가위치": "모든 이동평균선 위",
    "골든크로스": "20일선이 60일선 상향 돌파",
    "이동평균선밀집도": "확산 추세"
  },
  "MACD": {
    "MACD위치": "시그널 선 위",
    "히스토그램변화": "양의 히스토그램 확대",
    "다이버전스": "다이버전스 없음"
  },
  "RSI": {
    "RSI구간": "중립",
    "다이버전스": "다이버전스 없음"
  },
  "투자아이디어": {
    "단기추세": "상승",
    "매매시점": "매수",
    "핵심포인트": "이동평균선 정배열과 MACD 상승 신호로 단기 상승 추세 지속 예상"
  }
}
```

## 🔧 설정 및 문제해결

### API 키 설정
1. https://makersuite.google.com/app/apikey 접속
2. Google 계정으로 로그인
3. 'Create API Key' 클릭하여 API 키 생성
4. `python setup_api_key.py` 실행하여 키 입력

### 환경변수 설정 (선택사항)
```bash
# Windows
set GOOGLE_AI_API_KEY=your_api_key_here

# Linux/macOS
export GOOGLE_AI_API_KEY=your_api_key_here
```

### 문제해결
- **차트 이미지가 없는 경우**: 먼저 해당 차트 생성 프로그램을 실행
- **API 키 오류**: `setup_api_key.py`로 키 재설정
- **라이브러리 오류**: `pip install -r requirements.txt` 재실행

## 📊 실행 예시

### 통합 분석 (새로운 플로우)
```
🚀 통합 주식 분석 프로그램
============================================================
📊 종목명 입력 → 차트 유형 선택 → 차트 생성 → AI 분석
============================================================

📈 1단계: 종목명 입력
--------------------------------------------------
📈 종목명을 입력하세요 (예: 삼성전자, SK하이닉스): 삼성전자

📊 2단계: 차트 유형 선택
--------------------------------------------------
📊 분석할 차트 유형을 선택하세요:
   1. 일봉 차트
   2. 주봉 차트
   3. 월봉 차트

📊 차트 유형을 선택하세요 (1-3): 1

📈 3단계: 일봉 차트 생성
--------------------------------------------------
🔍 삼성전자 일봉 데이터 조회 중...
✅ 일봉 차트 생성 완료

🤖 4단계: AI 일봉 차트 분석
--------------------------------------------------
🔍 분석 시작: 삼성전자
📁 파일: daily_charts/daily_Samsung_Electronics_Co.,_Ltd._005930_20250115.png
📊 차트 유형: 일봉
✅ AI 분석 완료
📄 JSON 결과 파일: ai_analysis_results/analysis_daily_삼성전자_20250115_143025.json
📄 Word 문서 파일: ai_analysis_results/analysis_daily_삼성전자_20250115_143025.docx
```

### 배치 분석 (NEW!)
```
🚀 배치 주식 분석 프로그램
============================================================
📊 다중 종목 빠른 분석 시스템
============================================================

📈 배치 분석을 위한 종목 목록 입력
--------------------------------------------------
📝 입력 방법:
   1. 종목코드만 입력 (예: 005930, 000660, 035420)
   2. 종목명만 입력 (예: 삼성전자, SK하이닉스, NAVER)
   3. 혼합 입력 가능 (예: 005930, SK하이닉스, 035420)
   4. 파일에서 읽기 (stock_list.txt 파일에 한 줄에 하나씩)

📊 입력 방법을 선택하세요 (1: 직접입력, 2: 파일읽기): 2
✅ 파일에서 읽은 종목 수: 50개

📊 차트 유형 선택
--------------------------------------------------
📊 분석할 차트 유형을 선택하세요:
   1. 일봉 차트
   2. 주봉 차트
   3. 월봉 차트

📊 차트 유형을 선택하세요 (1-3): 1

⚙️ 병렬 처리 설정
--------------------------------------------------
🔧 동시 처리할 종목 수 (기본값: 5, 권장: 3-10): 5

🚀 배치 분석 시작
📊 총 50개 종목 | 차트 유형: 일봉 | 동시 처리: 5개
------------------------------------------------------------
📊 진행률: 100.0% (50/50) | 성공: 48 | 실패: 2 | 예상 남은 시간: 0.0분

====================================
🎉 배치 분석 완료!
====================================

📊 분석 통계:
   📈 총 종목 수: 50개
   ✅ 완전 성공: 48개 (96.0%)
   📊 차트만 성공: 0개
   ❌ 실패: 2개 (4.0%)
   📊 차트 유형: 일봉

✅ 완전 성공한 종목들:
   - 005930 (005930)
   - 삼성전자 (005930)
   - 000660 (000660)
   ...

❌ 실패한 종목들:
   - 999999: 종목코드를 찾을 수 없습니다
   - 테스트종목: 종목코드를 찾을 수 없습니다

📁 생성된 파일들:
   📈 차트 이미지: daily_charts/ 폴더
   🤖 AI 분석 결과: ai_analysis_results/ 폴더
   📄 배치 요약: batch_analysis_summary_일봉_20250115_143025.json

⏱️ 총 소요 시간: 15.2분 (912초)
📊 평균 처리 시간: 18.2초/종목
```

### AI 분석 결과
```
📈 투자 아이디어:
   추세: 상승
   매매 시점: 매수
   핵심 포인트: 이동평균선 정배열과 MACD 상승 신호로 단기 상승 추세 지속 예상
```

## 🆕 새로운 기능

### 🚀 배치 분석 시스템 (NEW!)
- **병렬 처리**: ThreadPoolExecutor를 활용한 다중 종목 동시 분석
- **진행률 추적**: 실시간 진행률 및 예상 완료 시간 표시
- **유연한 입력**: 종목코드, 종목명 혼합 입력 및 파일 기반 입력 지원
- **결과 요약**: 전체 분석 통계 및 개별 파일 자동 저장
- **에러 처리**: 개별 종목 실패 시에도 전체 프로세스 계속 진행

### 📊 프롬프트 관리 시스템
- **ChartAnalysisPrompts 클래스**로 프롬프트 체계적 관리
- **일봉/주봉/월봉별 특화 프롬프트** 제공
- **차트 유형별 최적화된 분석** 수행

### 🔄 개선된 플로우
- **종목명 기반 입력** (종목코드 자동 매핑)
- **차트 유형 선택** (일봉/주봉/월봉)
- **자동화된 차트 생성 및 AI 분석**
- **차트 유형별 파일명 구분**

### 📁 체계적인 파일 관리
- **차트 유형별 폴더 분리** (daily_charts/, weekly_charts/, monthly_charts/)
- **분석 결과 파일명에 차트 유형 포함**
- **종목별 결과 파일 그룹화**

## 📝 라이선스

이 프로젝트는 교육 및 개인 사용 목적으로 제작되었습니다.

## 🤝 기여

버그 리포트나 기능 제안은 이슈를 통해 제출해주세요.

## 📞 지원

문제가 발생하거나 질문이 있으시면 이슈를 통해 문의해주세요. 